<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		body {
			margin: 0;
			padding: 0;
			font-family: Arial, sans-serif;
			background: #fff;
		}
		.container {
			max-width: 480px;
			margin: 0 auto;
			padding: 16px;
			min-height: 700px; /* Ensure enough vertical space for PayPal form */
			overflow: visible; /* Prevent clipping of child content */
		}
		h2 {
			font-size: 1.3em;
			margin-bottom: 10px;
		}
		p {
			font-size: 1.1em;
		}
		#paypal-button-container {
			margin-top: 18px;
			min-height: 400px; /* Ensure PayPal widget has enough space */
			overflow: visible;
		}
		#message {
			margin-top: 18px;
			font-size: 1em;
		}
		.powered-by {
			margin-top: 16px;
			text-align: center;
		}
		@media (max-width: 600px) {
			.container {
				padding: 8px;
				min-height: 600px;
			}
			h2 {
				font-size: 1.1em;
			}
			p {
				font-size: 1em;
			}
			#paypal-button-container {
				margin-top: 12px;
				min-height: 350px;
			}
			#message {
				font-size: 0.95em;
			}
			.powered-by img {
				height: 28px !important;
			}
		}
	</style>
	<script src="https://www.paypal.com/sdk/js?client-id=ATtZDYlQ3kHPwtce0nb2OwWVmN_M6K16lRuZLYSHHT0eHCMiQTiUR15TSCpBE0LyT9Vvbe1Cxufkkpo5&currency=USD"></script>
	<title>PayPal Store</title>
</head>
<body>
	<div class="container">
		<h2>Pay Joshua Morvant with PayPal</h2>
	<ul style="margin:18px 0 0 18px;padding:0;font-size:1.05em;color:#222;">
			<li>1 hour tutoring</li>
		</ul>
		<div style="display:flex;align-items:center;gap:10px;margin:18px 0 24px 0;">
			<p style="color:#347d1b;font-weight:bold;margin:0;">Amount: $50.00 USD</p>
			<span style="font-size:0.9em;color:#888;">+$2.00 service fee</span>
		</div>
		<div id="paypal-button-container"></div>
		<!-- Remove static powered-by-paypal image -->
		<div id="message"></div>
	</div>

	<script>
	const devMode = false; // Set to false for production
	function showConfirmation(amount) {
		document.getElementById('message').innerHTML = `
			<div style="background:#e6f7ff;border:2px solid #0070ba;padding:24px 12px;margin:18px 0;font-size:2em;font-weight:bold;color:#0070ba;text-align:center;border-radius:12px;box-shadow:0 2px 8px #0070ba22;">
				<span style='font-size:2.5em;display:block;margin-bottom:10px;'>✔️</span>
				Payment of $${amount} USD was successfully processed.
			</div>
		`;
	}
	paypal.Buttons({
		fundingSource: paypal.FUNDING.CARD,
		createOrder: async function(data, actions) {
			const amount = 52.00; // $50 + $2 service fee
			const response = await fetch('https://joshuamorvant.com/create-order', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ amount })
			});
			const order = await response.json();
			return order.id;
		},
		onApprove: async function(data, actions) {
			const response = await fetch('https://joshuamorvant.com/capture-order', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ orderId: data.orderID })
			});
			const captureData = await response.json();
			showConfirmation(captureData.purchase_units[0].payments.captures[0].amount.value);
		},
		onError: function(err) {
			document.getElementById('message').textContent = 'Payment failed: ' + err;
		}
	}).render('#paypal-button-container');

		// Inject Powered by PayPal image directly below the card button after render
		setTimeout(function() {
			var container = document.getElementById('paypal-button-container');
			if (container) {
				var img = document.createElement('img');
				img.src = 'https://techtolia.com/PayPal/assets/images/powered_by_paypal.png';
				img.alt = 'Powered by PayPal';
				img.style.display = 'block';
				img.style.margin = '16px auto 0 auto';
				img.style.height = '32px';
				container.appendChild(img);
			}
		}, 800);

		// Show confirmation message in devMode
		// DevMode confirmation removed for production!
	</script>
</body>
</html>
